<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S∆° ƒë·ªì Ki·∫øn tr√∫c Microservice</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a2332 0%, #2c3e50 100%);
            min-height: 100vh;
            overflow: hidden;
        }
        .container {
            background: rgba(26, 35, 50, 0.9);
            height: 100vh;
            position: relative;
            overflow: hidden;
        }
        h1 {
            text-align: center;
            color: white;
            margin: 0;
            padding: 15px 0;
            background: rgba(26, 35, 50, 0.95);
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            position: relative;
            z-index: 1000;
        }
        
        /* Toolbar c√¥ng c·ª• */
        .toolbar {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            padding: 10px;
            z-index: 1001;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .tool-btn {
            width: 45px;
            height: 45px;
            border: none;
            border-radius: 8px;
            background: #007bff;
            color: white;
            cursor: pointer;
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .tool-btn:hover {
            background: #0056b3;
            transform: scale(1.05);
        }
        
        .tool-btn:active {
            transform: scale(0.95);
        }
        
        .tool-btn.reset {
            background: #28a745;
        }
        
        .tool-btn.reset:hover {
            background: #1e7e34;
        }
        
        .tool-btn.home {
            background: #6f42c1;
        }
        
        .tool-btn.home:hover {
            background: #5a32a3;
        }
        
        /* Tooltip */
        .tool-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            right: 55px;
            top: 50%;
            transform: translateY(-50%);
            background: #333;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .tool-btn:hover::after {
            opacity: 1;
        }
        
        /* Container cho diagram c√≥ th·ªÉ zoom v√† pan */
        .diagram-container {
            position: absolute;
            top: 60px;
            left: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            cursor: grab;
        }
        
        .diagram-container.panning {
            cursor: grabbing;
        }
        
        .mermaid {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: 0 0;
            transition: transform 0.3s ease;
        }
        
        .mermaid svg {
            overflow: visible;
            width: 100%;
            height: auto;
            min-height: 100%;
        }
        
        /* Zoom level indicator */
        .zoom-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 1001;
        }

        /* T√πy ch·ªânh m√†u n·ªÅn cho c√°c subgraph ch√≠nh */
        .mermaid .cluster rect {
            opacity: 0.4 !important;
        }
        
        /* Force m√†u cho c√°c subgraph b·∫±ng CSS */
        .mermaid svg g.cluster:nth-child(1) rect {
            fill: #E3F2FD !important;
        }
        .mermaid svg g.cluster:nth-child(2) rect {
            fill: #E8F5E8 !important;
        }
        .mermaid svg g.cluster:nth-child(3) rect {
            fill: #F3E5F5 !important;
        }
        .mermaid svg g.cluster:nth-child(4) rect {
            fill: #FFF3E0 !important;
        }
        
        /* ·∫®n ho√†n to√†n c√°c spacer nodes */
        .mermaid g[id*="SPACER"] {
            display: none !important;
        }
        
        /* ƒê·∫∑t t·∫•t c·∫£ text trong s∆° ƒë·ªì m√†u ƒë·ªè */
        .mermaid text {
            fill: #ff0000 !important;
            color: #ff0000 !important;
        }
        
        .mermaid .node text,
        .mermaid .cluster text,
        .mermaid .edgeLabel text,
        .mermaid .label text {
            fill: #ff0000 !important;
            color: #ff0000 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>S∆° ƒë·ªì Ki·∫øn tr√∫c Microservice</h1>
        
        <!-- Toolbar c√¥ng c·ª• -->
        <div class="toolbar">
            <button class="tool-btn home" data-tooltip="V·ªÅ trang ch·ªß" onclick="goHome()">üè†</button>
            <button class="tool-btn" data-tooltip="Ph√≥ng to" onclick="zoomIn()">üîç+</button>
            <button class="tool-btn" data-tooltip="Thu nh·ªè" onclick="zoomOut()">üîç-</button>
            <button class="tool-btn reset" data-tooltip="ƒê·∫∑t l·∫°i" onclick="resetZoom()">‚ö°</button>
            <button class="tool-btn" data-tooltip="Fit m√†n h√¨nh" onclick="fitToScreen()">üìê</button>
        </div>
        
        <!-- Zoom indicator -->
        <div class="zoom-indicator" id="zoomIndicator">100%</div>
        
        <!-- Container cho diagram -->
        <div class="diagram-container" id="diagramContainer">
            <div class="mermaid" id="mermaidDiagram">
graph TB
    subgraph "Frontend Applications"
        direction TB
        ShellAppUser[Shell App User]
        ShellAppAdmin[Shell App Admin]
        
        subgraph "User Frontend Components"
            direction TB
            CartFE[Cart Service Frontend<br>Giao di·ªán Gi·ªè h√†ng]:::frontend
            ProductFE[Product Service Frontend<br>Giao di·ªán S·∫£n ph·∫©m]:::frontend
            NewsFE[News Service Frontend<br>Giao di·ªán Tin t·ª©c]:::frontend
            DesignCalculationFE[Design Calculation Frontend<br>Giao di·ªán T√≠nh to√°n Thi·∫øt k·∫ø]:::frontend
            FootballFE[Football Service Frontend<br>Giao di·ªán B√≥ng ƒë√°]:::frontend
            CommunicationLogFE[Communication Log Frontend<br>Giao di·ªán Nh·∫≠t k√Ω thi c√¥ng]:::frontend
            ChatbotFE[Chatbot Service Frontend<br>Giao di·ªán Chatbot]:::frontend
            PaymentFE[Payment Service Frontend<br>Giao di·ªán Thanh to√°n]:::frontend
            UserFE[User Service Frontend<br>Giao di·ªán Ng∆∞·ªùi d√πng]:::frontend
            AdminFE[Admin Service Frontend<br>Giao di·ªán Qu·∫£n tr·ªã]:::frontend
            AgentManagementFE[Agent Management Frontend<br>Giao di·ªán Qu·∫£n l√Ω ƒê·∫°i l√Ω]:::frontend
            AgentPolicyFE[Agent Policy Frontend<br>Giao di·ªán Ch√≠nh s√°ch ƒê·∫°i l√Ω]:::frontend
        end
        
        subgraph "Admin Frontend Components"
            direction TB
            CartAdminFE[Cart Service Admin<br>Qu·∫£n tr·ªã Gi·ªè h√†ng]:::adminfe
            ProductAdminFE[Product Service Admin<br>Qu·∫£n tr·ªã S·∫£n ph·∫©m]:::adminfe
            NewsAdminFE[News Service Admin<br>Qu·∫£n tr·ªã Tin t·ª©c]:::adminfe
            DesignCalculationAdminFE[Design Calculation Admin<br>Qu·∫£n tr·ªã T√≠nh to√°n Thi·∫øt k·∫ø]:::adminfe
            FootballAdminFE[Football Service Admin<br>Qu·∫£n tr·ªã B√≥ng ƒë√°]:::adminfe
            CommunicationLogAdminFE[Communication Log Admin<br>Qu·∫£n tr·ªã Nh·∫≠t k√Ω thi c√¥ng]:::adminfe
            ChatbotAdminFE[Chatbot Service Admin<br>Qu·∫£n tr·ªã Chatbot]:::adminfe
            PaymentAdminFE[Payment Service Admin<br>Qu·∫£n tr·ªã Thanh to√°n]:::adminfe
            UserAdminFE[User Service Admin<br>Qu·∫£n tr·ªã Ng∆∞·ªùi d√πng]:::adminfe
            AdminAdminFE[Admin Service Admin<br>Qu·∫£n tr·ªã H·ªá th·ªëng]:::adminfe
            AgentManagementAdminFE[Agent Management Admin<br>Qu·∫£n tr·ªã ƒê·∫°i l√Ω]:::adminfe
            AgentPolicyAdminFE[Agent Policy Admin<br>Qu·∫£n tr·ªã Ch√≠nh s√°ch ƒê·∫°i l√Ω]:::adminfe
            ShellConfigAdminFE[Shell Config Admin<br>Qu·∫£n tr·ªã C·∫•u h√¨nh Shell]:::adminfe
        end
    end

    %% T·∫°o kho·∫£ng c√°ch ƒë·ªÉ ƒë·∫©y h√†ng tr√™n l√™n cao
    SPACER1[ ]:::invisible
    SPACER2[ ]:::invisible
    SPACER3[ ]:::invisible
    SPACER4[ ]:::invisible
    SPACER5[ ]:::invisible
    SPACER6[ ]:::invisible
    SPACER7[ ]:::invisible
    SPACER8[ ]:::invisible

    subgraph "API Gateway (C·ªïng API)"
        direction TB
        APIGatewayUser[API Gateway User]
        APIGatewayAdmin[API Gateway Admin]
    end

    subgraph "Backend Microservices (C√°c d·ªãch v·ª• ƒë·ªôc l·∫≠p)"
            CartService(Cart Service<br>D·ªãch v·ª• Gi·ªè h√†ng):::group1
        ProductService(Product Service<br>D·ªãch v·ª• S·∫£n ph·∫©m):::group1
        NewsService(News Service<br>D·ªãch v·ª• Tin t·ª©c):::group1
        
            DesignCalculationService(Design Calculation Service<br>D·ªãch v·ª• T√≠nh to√°n Thi·∫øt k·∫ø):::group2
        FootballService(Football Service<br>D·ªãch v·ª• B√≥ng ƒë√°):::group2
        CommunicationLogService(Communication Log Service<br>D·ªãch v·ª• Nh·∫≠t k√Ω thi c√¥ng):::group2
        ChatbotService(Chatbot Service<br>D·ªãch v·ª• Chatbot):::group2
        
            PaymentService(Payment Service<br>D·ªãch v·ª• Thanh to√°n):::group3
        UserService(User Service<br>D·ªãch v·ª• Ng∆∞·ªùi d√πng):::group3
        ShellConfigService(Shell Config Service<br>D·ªãch v·ª• C·∫•u h√¨nh Shell):::group3
        AdminService(Admin Service<br>D·ªãch v·ª• Qu·∫£n tr·ªã):::group3
        
            AgentManagementService(Agent Management Service<br>D·ªãch v·ª• Qu·∫£n l√Ω ƒê·∫°i l√Ω):::group4
        AgentPolicyService(Agent Policy Service<br>D·ªãch v·ª• Ch√≠nh s√°ch ƒê·∫°i l√Ω):::group4
    end

    subgraph "Infrastructure (H·∫° t·∫ßng)"
        direction TB
        MessageBroker(Message Broker)
        Cache(Cache)
        
        subgraph "Databases"
            direction TB
            CartDB[Cart DB]:::newdb
            ProductDB[Product DB]:::newdb
            NewsDB[News DB]:::newdb
            DesignCalculationDB[Design Calculation DB]
            FootballDB[Football DB]:::newdb
            CommunicationLogDB[Communication Log DB]:::newdb
            ChatbotDB[Chatbot DB]
            PaymentDB[Payment DB]
            UserDB[User DB]
            ShellConfigDB[Shell Config DB]:::newdb
            AdminDB[Admin DB]
            AgentManagementDB[Agent Management DB]
            AgentPolicyDB[Agent Policy DB]
        end
    end

    ShellAppUser --> APIGatewayUser
    ShellAppAdmin --> APIGatewayAdmin
    
    %% Shell App User loads c√°c frontend components
    ShellAppUser --> CartFE
    ShellAppUser --> ProductFE
    ShellAppUser --> NewsFE
    ShellAppUser --> DesignCalculationFE
    ShellAppUser --> FootballFE
    ShellAppUser --> CommunicationLogFE
    ShellAppUser --> ChatbotFE
    ShellAppUser --> PaymentFE
    ShellAppUser --> UserFE
    ShellAppUser --> AdminFE
    ShellAppUser --> AgentManagementFE
    ShellAppUser --> AgentPolicyFE

    %% Shell App Admin loads c√°c admin frontend components
    ShellAppAdmin --> CartAdminFE
    ShellAppAdmin --> ProductAdminFE
    ShellAppAdmin --> NewsAdminFE
    ShellAppAdmin --> DesignCalculationAdminFE
    ShellAppAdmin --> FootballAdminFE
    ShellAppAdmin --> CommunicationLogAdminFE
    ShellAppAdmin --> ChatbotAdminFE
    ShellAppAdmin --> PaymentAdminFE
    ShellAppAdmin --> UserAdminFE
    ShellAppAdmin --> AdminAdminFE
    ShellAppAdmin --> AgentManagementAdminFE
    ShellAppAdmin --> AgentPolicyAdminFE
    ShellAppAdmin --> ShellConfigAdminFE

    %% Frontend components k·∫øt n·ªëi v·ªõi backend services th√¥ng qua API Gateway
    CartFE --> APIGatewayUser
    ProductFE --> APIGatewayUser
    NewsFE --> APIGatewayUser
    DesignCalculationFE --> APIGatewayUser
    FootballFE --> APIGatewayUser
    CommunicationLogFE --> APIGatewayUser
    ChatbotFE --> APIGatewayUser
    PaymentFE --> APIGatewayUser
    UserFE --> APIGatewayUser
    AdminFE --> APIGatewayUser
    AgentManagementFE --> APIGatewayUser
    AgentPolicyFE --> APIGatewayUser

    %% Admin Frontend components k·∫øt n·ªëi v·ªõi backend services th√¥ng qua API Gateway Admin
    CartAdminFE --> APIGatewayAdmin
    ProductAdminFE --> APIGatewayAdmin
    NewsAdminFE --> APIGatewayAdmin
    DesignCalculationAdminFE --> APIGatewayAdmin
    FootballAdminFE --> APIGatewayAdmin
    CommunicationLogAdminFE --> APIGatewayAdmin
    ChatbotAdminFE --> APIGatewayAdmin
    PaymentAdminFE --> APIGatewayAdmin
    UserAdminFE --> APIGatewayAdmin
    AdminAdminFE --> APIGatewayAdmin
    AgentManagementAdminFE --> APIGatewayAdmin
    AgentPolicyAdminFE --> APIGatewayAdmin
    ShellConfigAdminFE --> APIGatewayAdmin

    APIGatewayUser --> CartService
    APIGatewayUser --> ProductService
    APIGatewayUser --> NewsService
    APIGatewayUser --> FootballService
    APIGatewayUser --> ChatbotService
    APIGatewayUser --> PaymentService
    APIGatewayUser --> UserService
    
    APIGatewayAdmin --> CartService
    APIGatewayAdmin --> ProductService
    APIGatewayAdmin --> NewsService
    APIGatewayAdmin --> DesignCalculationService
    APIGatewayAdmin --> FootballService
    APIGatewayAdmin --> CommunicationLogService
    APIGatewayAdmin --> ChatbotService
    APIGatewayAdmin --> PaymentService
    APIGatewayAdmin --> UserService
    APIGatewayAdmin --> ShellConfigService
    APIGatewayAdmin --> AdminService
    APIGatewayAdmin --> AgentManagementService
    APIGatewayAdmin --> AgentPolicyService

    AdminService --> UserService
    AdminService --> PaymentService
    AdminService --> AgentPolicyService
    AdminService --> AgentManagementService
    AdminService --> ProductService
    AdminService --> CartService
    AdminService --> NewsService
    AgentPolicyService --> PaymentService
    CartService --> ProductService
    CartService --> UserService
    CartService --> PaymentService
    FootballService --> UserService
    CommunicationLogService --> AdminService
    ShellConfigService --> AdminService

    PaymentService --> MessageBroker
    UserService --> MessageBroker
    AgentPolicyService --> Cache
    CartService --> MessageBroker
    ProductService --> Cache
    NewsService --> Cache
    FootballService --> Cache
    ShellConfigService --> Cache

    CartService --> CartDB
    ProductService --> ProductDB
    NewsService --> NewsDB
    DesignCalculationService --> DesignCalculationDB
    FootballService --> FootballDB
    CommunicationLogService --> CommunicationLogDB
    ChatbotService --> ChatbotDB
    PaymentService --> PaymentDB
    UserService --> UserDB
    ShellConfigService --> ShellConfigDB
    AdminService --> AdminDB
    AgentManagementService --> AgentManagementDB
    AgentPolicyService --> AgentPolicyDB

    %% Infrastructure Layer - N·ªÅn t·∫£ng h·∫° t·∫ßng ƒë·ªôc l·∫≠p
    subgraph "üèóÔ∏è Infrastructure Layer"
        direction TB
        InfrastructureBase[Infrastructure<br/>N·ªÅn t·∫£ng h·∫° t·∫ßng<br/>Docker, Kubernetes, Cloud Services<br/>Monitoring, Logging, Security]:::infrastructure
    end

    classDef group1 fill:#E6F3FF,stroke:#333,stroke-width:2px
    classDef group2 fill:#F0FFF0,stroke:#333,stroke-width:2px
    classDef group3 fill:#FFF0F5,stroke:#333,stroke-width:2px
    classDef group4 fill:#F5F5DC,stroke:#333,stroke-width:2px
    classDef newdb fill:#FFE4B5,stroke:#333,stroke-width:2px
    classDef frontend fill:#E6E6FA,stroke:#4B0082,stroke-width:2px
    classDef adminfe fill:#FFE4E1,stroke:#DC143C,stroke-width:2px
    classDef infrastructure fill:#F5F5F5,stroke:#2C3E50,stroke-width:3px
    
    %% ƒê·ªãnh nghƒ©a m√†u n·ªÅn cho subgraph
    classDef subgraph1 fill:#E3F2FD,stroke:#333,stroke-width:2px
    classDef subgraph2 fill:#E8F5E8,stroke:#333,stroke-width:2px  
    classDef subgraph3 fill:#F3E5F5,stroke:#333,stroke-width:2px
    classDef subgraph4 fill:#FFF3E0,stroke:#333,stroke-width:2px
    
    %% ·∫®n c√°c spacer nodes
    classDef invisible fill:transparent,stroke:transparent,color:transparent
            </div>
        </div>
    </div>

    <script>
        // Bi·∫øn to√†n c·ª•c cho zoom v√† pan
        let currentZoom = 1;
        let currentX = 0;
        let currentY = 0;
        let isDragging = false;
        let startX = 0;
        let startY = 0;

        // Kh·ªüi t·∫°o Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#00bcd4',
                primaryTextColor: '#ff0000',
                primaryBorderColor: '#00bcd4',
                lineColor: '#ff0000',
                secondaryColor: '#1a2332',
                tertiaryColor: '#2c3e50',
                // ƒê·∫∑t t·∫•t c·∫£ text m√†u ƒë·ªè
                nodeTextColor: '#ff0000',
                clusterTextColor: '#ff0000',
                edgeLabelBackground: 'transparent',
                edgeLabelColor: '#ff0000'
            }
        });

        // H√†m zoom in
        function zoomIn() {
            currentZoom = Math.min(currentZoom * 1.2, 3);
            updateTransform();
            updateZoomIndicator();
        }

        // H√†m zoom out
        function zoomOut() {
            currentZoom = Math.max(currentZoom / 1.2, 0.3);
            updateTransform();
            updateZoomIndicator();
        }

        // H√†m reset zoom
        function resetZoom() {
            currentZoom = 1;
            currentX = 0;
            currentY = 0;
            updateTransform();
            updateZoomIndicator();
        }

        // H√†m fit to screen
        function fitToScreen() {
            const mermaidElement = document.getElementById('mermaidDiagram');
            const svg = mermaidElement.querySelector('svg');
            if (svg) {
                const container = document.getElementById('diagramContainer');
                const containerRect = container.getBoundingClientRect();
                const svgRect = svg.getBoundingClientRect();
                
                const scaleX = containerRect.width / svgRect.width;
                const scaleY = containerRect.height / svgRect.height;
                currentZoom = Math.min(scaleX, scaleY) * 0.9;
                
                currentX = (containerRect.width - svgRect.width * currentZoom) / 2;
                currentY = (containerRect.height - svgRect.height * currentZoom) / 2;
                
                updateTransform();
                updateZoomIndicator();
            }
        }

        // H√†m quay v·ªÅ trang ch·ªß
        function goHome() {
            window.location.href = '../index.html';
        }

        // C·∫≠p nh·∫≠t transform
        function updateTransform() {
            const mermaidElement = document.getElementById('mermaidDiagram');
            mermaidElement.style.transform = `translate(${currentX}px, ${currentY}px) scale(${currentZoom})`;
        }

        // C·∫≠p nh·∫≠t zoom indicator
        function updateZoomIndicator() {
            document.getElementById('zoomIndicator').textContent = Math.round(currentZoom * 100) + '%';
        }

        // X·ª≠ l√Ω mouse wheel cho zoom
        document.getElementById('diagramContainer').addEventListener('wheel', function(e) {
            e.preventDefault();
            if (e.deltaY < 0) {
                zoomIn();
            } else {
                zoomOut();
            }
        });

        // X·ª≠ l√Ω drag ƒë·ªÉ pan
        const container = document.getElementById('diagramContainer');
        
        container.addEventListener('mousedown', function(e) {
            isDragging = true;
            startX = e.clientX - currentX;
            startY = e.clientY - currentY;
            container.classList.add('panning');
        });

        document.addEventListener('mousemove', function(e) {
            if (isDragging) {
                currentX = e.clientX - startX;
                currentY = e.clientY - startY;
                updateTransform();
            }
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
            container.classList.remove('panning');
        });

        // Kh·ªüi t·∫°o diagram khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            try {
                mermaid.run().then(() => {
                    console.log('Mermaid diagram rendered successfully');
                    // Fit to screen sau khi render xong
                    setTimeout(fitToScreen, 500);
                });
            } catch (error) {
                console.error('Error rendering Mermaid diagram:', error);
                document.getElementById('mermaidDiagram').innerHTML = '<p style="color: red; text-align: center; margin-top: 50px;">Error rendering diagram. Please refresh the page.</p>';
            }
        });
    </script>
</body>
</html>
